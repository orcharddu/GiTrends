/*!
 * chartjs-gauge.js v0.2.0
 * https://github.com/haiiaaa/chartjs-gauge/
 * (c) 2020 chartjs-gauge.js Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):(t=t||self).Gauge=e(t.Chart)}(this,(function(t){"use strict";function e(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function a(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}(t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t).defaults._set("gauge",{needle:{radiusPercentage:2,widthPercentage:3.2,lengthPercentage:80,color:"rgba(0, 0, 0, 1)"},valueLabel:{display:!0,formatter:null,color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 1)",borderRadius:5,padding:{top:5,right:5,bottom:5,left:5},bottomMarginPercentage:5},animation:{duration:1e3,animateRotate:!0,animateScale:!1},cutoutPercentage:50,rotation:-Math.PI,circumference:Math.PI,legend:{display:!1},tooltips:{enabled:!1}});var r=t.controllers.doughnut.extend({getMaxValue:function(t){return t[t.length-1]||1},getWidth:function(t){return t.chartArea.right-t.chartArea.left},getTranslation:function(t){var e=t.chartArea,a=t.offsetX,r=t.offsetY;return{dx:(e.left+e.right)/2+a,dy:(e.top+e.bottom)/2+r}},getAngle:function(t){var e=t.chart,a=t.value,r=t.maxValue,n=e.options;return n.rotation+n.circumference*(a/r)},drawNeedle:function(t){this.chart.animating||(t=1);var e=this.chart,a=e.ctx,r=e.config,n=e.innerRadius,o=e.outerRadius,i=r.data.datasets[this.index],l=this.getMeta().previous,c=r.options.needle,s=c.radiusPercentage,u=c.widthPercentage,h=c.lengthPercentage,d=c.color,g=this.getWidth(this.chart),f=s/100*g,p=u/100*g,b=h/100*(o-n)+n,m=this.getTranslation(this.chart),v=m.dx,y=m.dy,x=this.getAngle({chart:this.chart,value:l.value,maxValue:l.maxValue}),P=x+(this.getAngle({chart:this.chart,value:i.value,maxValue:this.getMaxValue(i.data)})-x)*t;a.save(),a.translate(v,y),a.rotate(P),a.fillStyle=d,a.beginPath(),a.ellipse(0,0,f,f,0,0,2*Math.PI),a.fill(),a.beginPath(),a.moveTo(0,p/2),a.lineTo(b,0),a.lineTo(0,-p/2),a.fill(),a.restore()},drawValueLabel:function(e){if(this.chart.config.options.valueLabel.display){var a=this.chart,r=a.ctx,n=a.config,o=n.options.defaultFontFamily,i=n.data.datasets[this.index],l=n.options.valueLabel,c=l.formatter,s=l.fontSize,u=l.color,h=l.backgroundColor,d=l.borderRadius,g=l.padding,f=l.bottomMarginPercentage/100*this.getWidth(this.chart),p=(c||function(t){return t})(i.value).toString();r.textBaseline="middle",r.textAlign="center",s&&(r.font="".concat(s,"px ").concat(o));var b=r.measureText(p).width,m=Math.max(r.measureText("m").width,r.measureText("ï¼·").width),v=-(g.left+b/2),y=-(g.top+m/2),x=g.left+b+g.right,P=g.top+m+g.bottom,w=this.getTranslation(this.chart),O=w.dx,M=w.dy,j=this.chart.options.rotation%(2*Math.PI);O+=f*Math.cos(j+Math.PI/2),M+=f*Math.sin(j+Math.PI/2),r.save(),r.translate(O,M),r.beginPath(),t.helpers.canvas.roundedRect(r,v,y,x,P,d),r.fillStyle=h,r.fill(),r.fillStyle=u||n.options.defaultFontColor;r.fillText(p,0,.075*m),r.restore()}},update:function(e){var a=this.chart.config.data.datasets[this.index],r=this.getMeta(),n={value:0,maxValue:1};e?(r.previous=null,r.current=n):(a.data.sort((function(t,e){return t-e})),r.previous=r.current||n,r.current={value:a.value,maxValue:this.getMaxValue(a.data)}),t.controllers.doughnut.prototype.update.call(this,e)},updateElement:function(r,n,o){t.controllers.doughnut.prototype.updateElement.call(this,r,n,o);var i=this.getDataset().data,l=this.chart.config.options,c=this.getMaxValue(i),s=i[n-1]||0,u=i[n],h=l.rotation+l.circumference*(s/c),d=h+l.circumference*((u-s)/c),g=d-h;r._model=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(a){e(t,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},r._model,{startAngle:h,endAngle:d,circumference:g})},draw:function(e){t.controllers.doughnut.prototype.draw.call(this,e),this.drawNeedle(e),this.drawValueLabel(e)}});return void 0===CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(t,e,a,r,n,o,i,l){this.save(),this.translate(t,e),this.rotate(n),this.scale(a,r),this.arc(0,0,1,o,i,l),this.restore()}),t.controllers.gauge=r,t.Gauge=function(e,a){return a.type="gauge",new t(e,a)},t.Gauge}));
